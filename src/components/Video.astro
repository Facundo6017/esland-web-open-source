---
import { getI18N } from '@/i18n/'
import Button from '@/components/Button.astro'
import Logo from '@/components/Logo.astro'

const { currentLocale } = Astro
const i18n = getI18N({ currentLocale })
---

<div
  class='relative h-dvh w-full max-w-[100vw] md:aspect-video md:h-[80vh] xl:h-full'
>
  <div
    class='absolute inset-0 z-10 m-auto flex h-full w-full flex-col items-center justify-center'
  >
    <section
      class='absolute z-10 flex animate-fade-up flex-col items-center justify-center gap-8'
    >
      <h1
        class='flex items-center gap-5 font-tomaso text-4xl md:text-6xl lg:gap-20 lg:text-8xl'
      >
        <span>E</span>
        <span>S</span>
        <span>L</span>
        <Logo
          class='h-9 w-auto scale-150 md:h-[3.75rem] lg:h-24'
          aria-label='A'
        />
        <span>N</span>
        <span>D</span>
      </h1>

      <p
        class='subtitle text-wrap px-4 text-center font-jura text-xl lg:text-2xl'
      >
        {i18n.HERO_SUBTITLE}
      </p>

      <Button
        target='_self'
        class='animate-fade-up bg-white text-blue-950'
        url='/vota'
      >
        {i18n.VIDEO_BUTTON}
      </Button>
    </section>

    <video
      autoplay
      loop
      muted
      playsinline
      id='main-video'
      preload='metadata'
      class='video cp-v hidden h-full w-full object-cover object-top animate-duration-[2s] animate-ease-in-out'
    >
      <source src='/video.webm' type='video/webm' />
      <source src='/video.mp4' type='video/mp4' />
    </video>
  </div>
  <video
    class='video absolute -bottom-48 -z-40 hidden blur-3xl animate-duration-[2s] animate-ease-in-out'
    autoplay
    loop
    muted
    preload='metadata'
  >
    <source src='/video.webm' type='video/webm' />
    <source src='/video.mp4' type='video/mp4' />
  </video>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    const firstVideo = document.querySelector('#main-video') as HTMLMediaElement

    if (firstVideo) {
      const videos = document.querySelectorAll(
        '.video'
      ) as NodeListOf<HTMLMediaElement>

      if (firstVideo.readyState >= 3) {
        videos.forEach((videoEl) => {
          videoEl.classList.remove('hidden')
          videoEl.classList.add('animate-fade')
        })

        return
      }

      firstVideo.addEventListener('loadeddata', () => {
        videos.forEach((videoEl) => {
          videoEl.classList.remove('hidden')
          videoEl.classList.add('animate-fade')
        })
      })
    }
  })
</script>

<style>
  @font-face {
    font-family: 'Jura';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url('/fonts/jura.woff2') format('woff2');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA,
      U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122,
      U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  }

  .subtitle {
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
  }
</style>
